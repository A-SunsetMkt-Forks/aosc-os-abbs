abinfo "Extracting previous source-built artifacts ..."
mkdir -v "$SRCDIR"/.dotnet "$SRCDIR"/prereqs/packages/previously-source-built
tar xf /usr/lib/dotnet/source-built-artifacts/dotnet-sdk-"$__SDKVER"."$RID".tar.gz -C "$SRCDIR"/.dotnet
tar xf /usr/lib/dotnet/source-built-artifacts/Private.SourceBuilt.Artifacts."$__SDKVER"."$RID".tar.gz -C "$SRCDIR"/prereqs/packages/previously-source-built

abinfo "Preparing for source-build ..."
./prep-source-build.sh --no-artifacts --no-sdk --with-sdk "$SRCDIR"/.dotnet --with-packages "$SRCDIR"/prereqs/packages/previously-source-built

abinfo "Building from source ..."
./build.sh --configuration Release --rid $RID --verbosity detailed --with-system-libs brotli+libunwind+rapidjson+zlib --source-build

abinfo "Deploying files ..."
install -dv "$PKGDIR"/usr/lib/dotnet/source-built-artifacts
mv -v "$SRCDIR"/artifacts/assets/Release/*.tar.gz "$PKGDIR"/usr/lib/dotnet/source-built-artifacts
