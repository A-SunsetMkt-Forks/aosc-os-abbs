From 3441b00c0a06521ad2a89eccad1e4f13d4ba56de Mon Sep 17 00:00:00 2001
From: Student Main <studentmain@aosc.io>
Date: Thu, 8 Aug 2024 19:44:01 +0000
Subject: [PATCH] use AOSC OS ca-certs certificate

---
 mitmproxy/net/tls.py | 3 +--
 pyproject.toml       | 2 --
 2 files changed, 1 insertion(+), 4 deletions(-)

diff --git a/mitmproxy/net/tls.py b/mitmproxy/net/tls.py
index 21b4754a4..87566e87a 100644
--- a/mitmproxy/net/tls.py
+++ b/mitmproxy/net/tls.py
@@ -8,7 +8,6 @@ from pathlib import Path
 from typing import Any
 from typing import BinaryIO
 
-import certifi
 from OpenSSL import crypto
 from OpenSSL import SSL
 from OpenSSL.crypto import X509
@@ -159,7 +158,7 @@ def create_proxy_server_context(
     context.set_verify(verify.value, None)
 
     if ca_path is None and ca_pemfile is None:
-        ca_pemfile = certifi.where()
+        ca_pemfile = "/etc/ssl/certs/ca-certificates.crt"
     try:
         context.load_verify_locations(ca_pemfile, ca_path)
     except SSL.Error as e:
diff --git a/pyproject.toml b/pyproject.toml
index bb6a90727..b1ef19c78 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -34,7 +34,6 @@ dependencies = [
     "aioquic>=1.1.0,<=1.2.0",
     "asgiref>=3.2.10,<=3.8.1",
     "Brotli>=1.0,<=1.1.0",
-    "certifi>=2019.9.11",  # no upper bound here to get latest CA bundle
     "cryptography>=42.0,<43.1",  # relaxed upper bound here to get security fixes
     "flask>=3.0,<=3.0.3",
     "h11>=0.11,<=0.14.0",
@@ -78,7 +77,6 @@ dev = [
     "build>=0.10.0,<=1.2.1",
     "mypy>=1.10.1,<=1.11.1",
     "ruff>=0.5.0,<=0.5.5",
-    "types-certifi>=2021.10.8.3,<=2021.10.8.3",
     "types-Flask>=1.1.6,<=1.1.6",
     "types-Werkzeug>=1.0.9,<=1.0.9",
     "types-requests>=2.32.0.20240622,<=2.32.0.20240712",
-- 
2.46.0

