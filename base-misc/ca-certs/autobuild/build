# Adapted from Linux from Scratch.

abinfo 'Setting up PATH to use CA utilities in $PKGDIR/usr/bin ...'
export PATH="$PKGDIR/usr/bin:$PATH"

abinfo "Installing CA utilities ..."
mkdir -pv "$PKGDIR/usr/bin"
cp -rv "$SRCDIR"/autobuild/overrides/usr/bin/* \
    "$PKGDIR"/usr/bin/

abinfo "Running make-ca ..."
"$SRCDIR"/autobuild/overrides/usr/bin/make-ca --destdir "$SRCDIR"

abinfo "Pruning expired certificates ..."
export SSLDIR="$PKGDIR/etc/ssl"
remove-expired-certs ${SRCDIR}/etc/ssl/certs

abinfo "Installing CA Certificates..."
install -dv "${SSLDIR}/certs"
cp -v "$SRCDIR"/etc/ssl/certs/*.pem "${SSLDIR}/certs"
abinfo "Installing CA bundle..."
cp -v "$SRCDIR"/etc/ssl/ca-bundle.crt "${SSLDIR}/"


abinfo "Creating a compatibility symlink for ca-certificates.crt ..."
ln -sv ../ca-bundle.crt "${SSLDIR}/certs/ca-certificates.crt"
