mkdir "$SRCDIR"/build
cd "$SRCDIR"/build

if [[ "${CROSS:-$ARCH}" = loongson3 ]]; then
    CMAKE_EXTRA_FLAGS="-DD_EXTRA_FLAGS=-mabi=n64"
fi

cmake .. \
      ${CMAKE_DEF} ${CMAKE_AFTER} -GNinja \
      ${CMAKE_EXTRA_FLAGS} \
      -DD_COMPILER_FLAGS="-link-defaultlib-shared=false -linker=gold -flto=full" \
      -DADDITIONAL_DEFAULT_LDC_SWITCHES="\"-link-defaultlib-shared\""
ninja
DESTDIR="$PKGDIR" ninja install

cd "$SRCDIR"
